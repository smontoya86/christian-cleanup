{% extends "base.html" %}

{% block title %}{{ playlist.name }} - Playlist Details - {{ super() }}{% endblock %}

{% block content %}
    <div class="container mt-4">
        <h2>{{ playlist.name }}</h2>
        <p>{{ playlist.description }}</p>
        <p><small>Owner: {{ playlist.owner_name }} | Score: {{ playlist.score if playlist.score is not none else 'N/A' }}</small></p>

        <hr>

        <h3>Tracks</h3>
        {% if songs_with_status %}
            <ul class="list-group">
                {% for song_data in songs_with_status %}
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        <div>
                            <strong>{{ song_data.song.title }}</strong> by {{ song_data.song.artist }}
                            <br>
                            <small>Album: {{ song_data.song.album }}</small>
                            <br>
                            {# Display Whitelist/Blacklist Status #}
                            {% if song_data.is_whitelisted %}
                                <span class="badge bg-success">Whitelisted</span>
                            {% elif song_data.is_blacklisted %}
                                <span class="badge bg-danger">Blacklisted</span>
                            {% endif %}
                            {# Display Analysis Results - adapting from memory #}
                            {% if song_data.themes_and_scriptures %}
                                <div class="mt-2 p-2 border rounded bg-light">
                                    <small><strong>Analysis:</strong> {{ song_data.themes_and_scriptures }}</small>
                                </div>
                            {% endif %}
                        </div>
                        {# Whitelist/Blacklist Actions for Songs #}
                        <div class="song-actions">
                            <form action="{{ url_for('main.whitelist_song', playlist_id=playlist.spotify_id, track_id=song_data.song.spotify_id) }}" method="POST" style="display: inline;">
                                <button type="submit" class="btn btn-success btn-sm" title="Whitelist Song">WL</button>
                            </form>
                            <form action="{{ url_for('main.blacklist_song', playlist_id=playlist.spotify_id, track_id=song_data.song.spotify_id) }}" method="POST" style="display: inline;">
                                <button type="submit" class="btn btn-danger btn-sm" title="Blacklist Song">BL</button>
                            </form>
                            <form action="{{ url_for('main.remove_whitelist_song', playlist_id=playlist.spotify_id, track_id=song_data.song.spotify_id) }}" method="POST" style="display: inline;">
                                <button type="submit" class="btn btn-outline-success btn-sm" title="Remove from Whitelist">-WL</button>
                            </form>
                            <form action="{{ url_for('main.remove_blacklist_song', playlist_id=playlist.spotify_id, track_id=song_data.song.spotify_id) }}" method="POST" style="display: inline;">
                                <button type="submit" class="btn btn-outline-danger btn-sm" title="Remove from Blacklist">-BL</button>
                            </form>
                        </div>
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <p>No songs found in this playlist or unable to retrieve song details.</p>
        {% endif %}

        <div class="mt-3">
            <a href="{{ url_for('main.dashboard') }}" class="btn btn-secondary">Back to Dashboard</a>
        </div>
    </div>
{% endblock %}
